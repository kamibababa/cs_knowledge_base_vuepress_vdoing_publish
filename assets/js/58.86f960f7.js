(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{503:function(s,e,n){"use strict";n.r(e);var a=n(14),r=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),e("blockquote",[e("p",[s._v("在日常开发中，我们与经常与 promise 打交道，因为在日常业务开发中，请求 API、WS、各种异步的回调都需要用 promise 来处理")])]),s._v(" "),e("h2",{attrs:{id:"_1-早期异步代码困境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-早期异步代码困境"}},[s._v("#")]),s._v(" 1. 早期异步代码困境")]),s._v(" "),e("ul",[e("li",[s._v("众所周知，js是单线程的，耗时操作都是交给浏览器来处理，等时间到了从队列中取出执行，设计到事件循环的概念，笔者也分享过，可以看以下，理解了可以更好的理解"),e("code",[s._v("promise")]),s._v("。")]),s._v(" "),e("li",[s._v("我以一个需求为切入点，我模拟网络请求(异步操作)\n"),e("ul",[e("li",[s._v("如果网络请求成功了，你告知我成功了")]),s._v(" "),e("li",[s._v("如果网络请求失败了，你告知我失败了")])])])]),s._v(" "),e("h3",{attrs:{id:"_1-1-大聪明做法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-大聪明做法"}},[s._v("#")]),s._v(" 1.1 大聪明做法")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function requestData(url) {\n  setTimeout(() => {\n    if (url === 'iceweb.io') {\n      return '请求成功'\n    }\n    return '请求失败'\n  }, 3000)\n}\n\nconst result = requestData('iceweb.io')\n\nconsole.log(result) //undefined\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("ul",[e("li",[s._v("首先你要理解"),e("code",[s._v("js")]),s._v("代码的执行顺序，而不是是想当然的，代码其实并不是按照你书写的顺序执行的。")]),s._v(" "),e("li",[s._v("那么为什么是 "),e("code",[s._v("undefined呢")]),s._v("？\n"),e("ul",[e("li",[s._v("首先当我执行"),e("code",[s._v("requestData")]),s._v("函数，开始执行函数。遇到了异步操作不会阻塞后面代码执行的，因为js是单线程的，所以你写的"),e("code",[s._v("return")]),s._v("成功或者失败并没有返回给"),e("code",[s._v("requestData")]),s._v("，那我这个函数中，抛开异步操作，里面并没有返回值，所以值为"),e("code",[s._v("undefined")]),s._v("。")])])])]),s._v(" "),e("h3",{attrs:{id:"_2-1-早期正确做法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-早期正确做法"}},[s._v("#")]),s._v(" 2.1 早期正确做法")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function requestData(url, successCB, failureCB) {\n  setTimeout(() => {\n    if (url === 'iceweb.io') {\n      successCB('我成功了,把获取到的数据传出去', [{name:'ice', age:22}])\n    } else {\n      failureCB('url错误，请求失败')\n    }\n  }, 3000)\n}\n\n//3s后 回调successCB \n//我成功了,把获取到的数据传出去 [ { name: 'ice', age: 22 } ]\nrequestData('iceweb.io', (res, data) => console.log(res, data), rej => console.log(rej))\n\n//3s后回调failureCB\n//url错误，请求失败\nrequestData('icexxx.io', res => console.log(res) ,rej => console.log(rej))\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("ul",[e("li",[s._v("早期解决方案都是传入两个回调，一个失败的，一个成功的。那很多开发者会问这不是挺好的吗？挺简单的，js中函数是一等公民，可以传来传去，但是这样太灵活了，没有规范。")]),s._v(" "),e("li",[s._v("如果使用的是框架，还要阅读一下框架源码，正确失败的传实参的顺序，如果传参顺序错误这样是非常危险的。")])]),s._v(" "),e("h2",{attrs:{id:"_2-promise"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-promise"}},[s._v("#")]),s._v(" 2. Promise")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("Promise")]),s._v("(承诺)，给予调用者一个承诺，过一会返回数据给你，就可以创建一个promise对象")]),s._v(" "),e("li",[s._v("当我们"),e("code",[s._v("new")]),s._v("一个"),e("code",[s._v("promise")]),s._v("，此时我们需要传递一个回调函数，这个函数为立即执行的，称之为（executor）")]),s._v(" "),e("li",[s._v("这个回调函数，我们需要传入两个参数回调函数，"),e("code",[s._v("reslove")]),s._v(","),e("code",[s._v("reject")]),s._v("(函数可以进行传参)\n"),e("ul",[e("li",[s._v("当执行了"),e("code",[s._v("reslove")]),s._v("函数，会回调promise对象的.then函数")]),s._v(" "),e("li",[s._v("当执行了"),e("code",[s._v("reject")]),s._v("函数，会回调promise对象的.catche函数")])])])]),s._v(" "),e("h3",{attrs:{id:"_2-1-executor立即执行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-executor立即执行"}},[s._v("#")]),s._v(" 2.1 Executor立即执行")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("new Promise((resolve, reject) => {\n  console.log(`executor 立即执行`)\n})\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[s._v("传入的"),e("code",[s._v("executor")]),s._v("是立即执行的")])]),s._v(" "),e("h3",{attrs:{id:"_2-2-requestdata-重构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-requestdata-重构"}},[s._v("#")]),s._v(" 2.2 requestData 重构")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function requestData(url) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (url === 'iceweb.io') {\n        //只能传递一个参数\n        resolve('我成功了,把获取到的数据传出去')\n      } else {\n        reject('url错误，请求失败')\n      }\n    }, 3000)    \n  })\n}\n\n//1. 请求成功\nrequestData('iceweb.io').then(res => {\n  //我成功了,把获取到的数据传出去\n  console.log(res)\n})\n\n//2. 请求失败\n\n//2.2 第一种写法\n//url错误，请求失败\nrequestData('iceweb.org').then(res => {},rej => console.log(rej))\n\n//2.2 第二种写法\n//url错误，请求失败\nrequestData('iceweb.org').catch(e => console.log(e))\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br")])]),e("ul",[e("li",[s._v("在函数中，new这个类的时候，传入的回调函数称之为"),e("code",[s._v("executor")]),s._v("（会被Promise类中自动执行）")]),s._v(" "),e("li",[s._v("在正确的时候调用"),e("code",[s._v("resolve")]),s._v("函数，失败的时候调用"),e("code",[s._v("reject")]),s._v("函数，把需要的参数传递出去。")]),s._v(" "),e("li",[s._v("异常处理\n"),e("ul",[e("li",[s._v("其中在"),e("code",[s._v(".then")]),s._v("方法中可以传入两个回调，您也可以查看"),e("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fpromisesaplus.com%2F",title:"https://promisesaplus.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Promise/A+"),e("OutboundLink")],1),s._v("规范\n"),e("ul",[e("li",[s._v("第一个则是"),e("code",[s._v("fulfilled")]),s._v("的回调")]),s._v(" "),e("li",[s._v("第二个则是"),e("code",[s._v("rejected")]),s._v("的回调")])])])])]),s._v(" "),e("li",[s._v("那这样有什么好处呢？ 看起来比早期处理的方案还要繁琐呢?\n"),e("ol",[e("li",[s._v("统一规范，可以增强阅读性和扩展性")]),s._v(" "),e("li",[s._v("小幅度减少回调地狱")])])])]),s._v(" "),e("h3",{attrs:{id:"_2-3-promise的状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-promise的状态"}},[s._v("#")]),s._v(" 2.3 promise的状态")]),s._v(" "),e("ul",[e("li",[s._v("首先先给大家举个栗子，把代码抽象为现实的栗子\n"),e("ul",[e("li",[s._v("你答应你女朋友，下周末带她去吃好吃的 (还未到下周末，此时状态为"),e("strong",[s._v("待定状态")]),s._v(")")]),s._v(" "),e("li",[s._v("时间飞快，今天就是周末了，你和你女友一起吃了烤肉、甜点、奶茶...（"),e("strong",[s._v("已兑现状态")]),s._v("）")]),s._v(" "),e("li",[s._v("时间飞快，今天就是周末了，正打算出门。不巧产品经理，因为线上出现的紧急问题，需要回公司解决一下，你(为了生活)只能委婉的拒绝一下女友，并且说明一下缘由("),e("strong",[s._v("已拒绝状态")]),s._v(")")])])]),s._v(" "),e("li",[s._v("使用"),e("code",[s._v("promise")]),s._v("的时候，给它一个承诺，我们可以将他划分为三个阶段\n"),e("ul",[e("li",[s._v("pending(待定)，执行了executor，状态还在等待中，没有被兑现，也没有被拒绝")]),s._v(" "),e("li",[s._v("fulfilled(已兑现)，执行了"),e("code",[s._v("resolve")]),s._v("函数则代表了已兑现状态")]),s._v(" "),e("li",[s._v("rejected(已拒绝)，执行了"),e("code",[s._v("reject")]),s._v("函数则代表了已拒绝状态")])])]),s._v(" "),e("li",[s._v("首先，状态只要从待定状态，变为其他状态，则状态不能再改变")])]),s._v(" "),e("p",[s._v("思考以下代码:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    reject('失败')\n    resolve('成功')\n  }, 3000);\n})\n\npromise.then(res => console.log(res)).catch(err => console.log(err))\n\n//失败 \n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("ul",[e("li",[s._v("当我调用"),e("code",[s._v("reject")]),s._v("之后，在调用"),e("code",[s._v("resolve")]),s._v("是无效的，因为状态已经发生改变，并且是不可逆的。")])]),s._v(" "),e("h3",{attrs:{id:"_2-4-resolve不同值的区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-resolve不同值的区别"}},[s._v("#")]),s._v(" 2.4 resolve不同值的区别")]),s._v(" "),e("ul",[e("li",[s._v("如果"),e("code",[s._v("resolve")]),s._v("传入一个普通的值或者对象，"),e("strong",[s._v("只能传递接受一个参数")]),s._v("，那么这个值会作为"),e("code",[s._v("then")]),s._v("回调的参数")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  resolve({name: 'ice', age: 22})\n})\n\npromise.then(res => console.log(res))\n\n// {name: 'ice', age: 22}\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ul",[e("li",[s._v("如果"),e("code",[s._v("resolve")]),s._v("中传入的是另外一个"),e("code",[s._v("Promise")]),s._v("，那么这个新"),e("code",[s._v("Promise")]),s._v("会决定原"),e("code",[s._v("Promise")]),s._v("的状态")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  resolve(new Promise((resolve, reject) => {\n    setTimeout(() => {\n      resolve('ice')\n    }, 3000);\n  }))\n})\n\npromise.then(res => console.log(res))\n\n//3s后 ice\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ul",[e("li",[s._v("如果"),e("code",[s._v("resolve")]),s._v("中传入的是一个对象，并且这个对象有实现"),e("code",[s._v("then")]),s._v("方法，那么会执行该"),e("code",[s._v("then")]),s._v("方法，"),e("code",[s._v("then")]),s._v("方法会传入"),e("code",[s._v("resolve")]),s._v("，"),e("code",[s._v("reject")]),s._v("函数。此时的"),e("code",[s._v("promise")]),s._v("状态取决于你调用了"),e("code",[s._v("resolve")]),s._v("，还是"),e("code",[s._v("reject")]),s._v("函数。这种模式也称之为: "),e("strong",[s._v("thenable")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  resolve({\n    then(res, rej) {\n      res('hi ice')\n    }\n  })\n})\n\npromise.then(res => console.log(res))\n\n// hi ice\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h3",{attrs:{id:"_2-5-promise的实例方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-promise的实例方法"}},[s._v("#")]),s._v(" 2.5 Promise的实例方法")]),s._v(" "),e("ul",[e("li",[s._v("实例方法，存放在"),e("code",[s._v("Promise.prototype")]),s._v("上的方法，也就是Promise的显示原型上，当我new Promise的时候，会把返回的改对象的 promise[[prototype]]（隐式原型） === Promise.prototype (显示原型)")]),s._v(" "),e("li",[s._v("即new返回的对象的隐式原型指向了Promise的显示原型")])]),s._v(" "),e("h4",{attrs:{id:"_2-5-1-then方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-1-then方法"}},[s._v("#")]),s._v(" 2.5.1 then方法")]),s._v(" "),e("h5",{attrs:{id:"_2-5-1-1-then的参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-1-1-then的参数"}},[s._v("#")]),s._v(" 2.5.1.1 then的参数")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("then")]),s._v("方法可以接受参数，一个参数为成功的回调，另一个参数为失败的回调，前面重构"),e("code",[s._v("requestData")]),s._v("中有演练过。")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  resolve('request success')\n  // reject('request error')\n})\n\npromise.then(res => console.log(res), rej => console.log(rej))\n\n//request success\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("ul",[e("li",[s._v("如果只捕获错误，还可以这样写\n"),e("ul",[e("li",[s._v("因为第二个参数是捕获异常的，第一个可以写个"),e("code",[s._v("null")]),s._v("或"),e("code",[s._v('""')]),s._v("占位")])])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  // resolve('request success')\n  reject('request error')\n})\n\npromise.then(null, rej => console.log(rej))\n\n//request error\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h5",{attrs:{id:"_2-5-1-2-then的多次调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-1-2-then的多次调用"}},[s._v("#")]),s._v(" 2.5.1.2 then的多次调用")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  resolve('hi ice')\n})\n\npromise.then(res => console.log(res))\npromise.then(res => console.log(res))\npromise.then(res => console.log(res))\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ul",[e("li",[s._v("调用多次则会执行多次")])]),s._v(" "),e("h5",{attrs:{id:"_2-5-1-3-then的返回值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-1-3-then的返回值"}},[s._v("#")]),s._v(" 2.5.1.3 then的返回值")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("then")]),s._v("方法是有返回值的，它的返回值是"),e("code",[s._v("promise")]),s._v("，但是是"),e("code",[s._v("promise")]),s._v("那它的状态如何决定呢？接下来让我们一探究竟。")])]),s._v(" "),e("h6",{attrs:{id:"_2-5-1-3-1-返回一个普通值-状态-fulfilled"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-1-3-1-返回一个普通值-状态-fulfilled"}},[s._v("#")]),s._v(" 2.5.1.3.1 返回一个普通值 "),e("em",[e("strong",[s._v("状态:fulfilled")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  resolve('hi ice')\n})\n\npromise.then(res => ({name:'ice', age:22}))\n       .then(res => console.log(res))\n       \n//{name:'ice', age:22}\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("ul",[e("li",[s._v("返回一个普通值，则相当于主动调用"),e("code",[s._v("Promise.resolve")]),s._v("，并且把返回值作为实参传递到"),e("code",[s._v("then")]),s._v("方法中。")]),s._v(" "),e("li",[s._v("如果没有返回值，则相当于返回"),e("code",[s._v("undefined")])])]),s._v(" "),e("h6",{attrs:{id:"_2-5-1-3-2-明确返回一个promise-状态-fulfilled"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-1-3-2-明确返回一个promise-状态-fulfilled"}},[s._v("#")]),s._v(" 2.5.1.3.2 明确返回一个promise "),e("em",[e("strong",[s._v("状态:fulfilled")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  resolve('hi ice')\n})\n\npromise.then(res => {\n  return new Promise((resolve, reject) => {\n    resolve('then 的返回值')\n  })\n}).then(res => console.log(res))\n\n//then 的返回值\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ul",[e("li",[s._v("主动返回一个"),e("code",[s._v("promise")]),s._v("对象，状态和你调用"),e("code",[s._v("resolve")]),s._v("，还是"),e("code",[s._v("reject")]),s._v("有关")])]),s._v(" "),e("h6",{attrs:{id:"_2-5-1-3-3-返回一个thenable对象-状态-fulfilled"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-1-3-3-返回一个thenable对象-状态-fulfilled"}},[s._v("#")]),s._v(" 2.5.1.3.3 返回一个thenable对象 "),e("em",[e("strong",[s._v("状态：fulfilled")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  resolve('hi ice')\n})\n\npromise.then(res => {\n  return {\n    then(resolve, reject) {\n      resolve('hi webice')\n    }\n  }\n}).then(res => console.log(res))\n\n//hi webice\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("ul",[e("li",[s._v("返回了一个thenable对象，其状态取决于你是调用了"),e("code",[s._v("resolve")]),s._v(",还是"),e("code",[s._v("reject")])])]),s._v(" "),e("h4",{attrs:{id:"_2-5-2-catch方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-2-catch方法"}},[s._v("#")]),s._v(" 2.5.2 catch方法")]),s._v(" "),e("h5",{attrs:{id:"_2-5-2-1-catch的多次调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-2-1-catch的多次调用"}},[s._v("#")]),s._v(" 2.5.2.1 catch的多次调用")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  reject('ice error')\n})\n\npromise.catch(err => console.log(err))\npromise.catch(err => console.log(err))\npromise.catch(err => console.log(err))\n\n//ice error\n//ice error\n//ice error\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h5",{attrs:{id:"_2-5-2-2-catch的返回值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-2-2-catch的返回值"}},[s._v("#")]),s._v(" 2.5.2.2 catch的返回值")]),s._v(" "),e("ul",[e("li",[s._v("catch方法是有返回值的，它的返回值是promise，但是是promise那它的状态如何决定呢？接下来让我们一探究竟。")]),s._v(" "),e("li",[s._v("如果返回值明确一个promise或者thenable对象，取决于你调用了"),e("code",[s._v("resolve")]),s._v("还是"),e("code",[s._v("reject")])])]),s._v(" "),e("h6",{attrs:{id:"_2-5-2-2-1-返回一个普通对象"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-2-2-1-返回一个普通对象"}},[s._v("#")]),s._v(" 2.5.2.2.1 返回一个普通对象")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  reject('ice error')\n})\n\npromise.catch(err => ({name:'ice', age: 22})).then(res => console.log(res))\n\n//{name:'ice', age: 22}\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h6",{attrs:{id:"_2-5-2-2-2-明确返回一个promise"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-2-2-2-明确返回一个promise"}},[s._v("#")]),s._v(" 2.5.2.2.2 明确返回一个promise")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  reject('ice error')\n})\n\npromise.catch(err => {\n  return new Promise((resolve, reject) => {\n    reject('ice error promise')\n  })\n}).catch(res => console.log(res))\n\n//ice error promise\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ul",[e("li",[s._v("此时"),e("code",[s._v("new Promise()")]),s._v(" 调用了"),e("code",[s._v("reject")]),s._v("函数，则会被"),e("code",[s._v("catch")]),s._v("捕获到")])]),s._v(" "),e("h6",{attrs:{id:"_2-5-2-2-3-返回thenable对象"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-2-2-3-返回thenable对象"}},[s._v("#")]),s._v(" 2.5.2.2.3 返回thenable对象")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  reject('ice error')\n})\n\npromise.catch(err => {\n  return {\n    then(resolve, reject) {\n      reject('ice error then')\n    }\n  }\n}).catch(res => console.log(res))\n\n//ice error then\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h4",{attrs:{id:"_2-5-3-finally方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-3-finally方法"}},[s._v("#")]),s._v(" 2.5.3 finally方法")]),s._v(" "),e("ul",[e("li",[s._v("ES9（2018）新实例方法")]),s._v(" "),e("li",[s._v("finally(最后)，无论promise状态是fulfilled还是rejected都会执行一次"),e("code",[s._v("finally")]),s._v("方法")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise = new Promise((resolve, reject) => {\n  resolve('hi ice')\n})\n\npromise.then(res => console.log(res)).finally(() => console.log('finally execute'))\n\n//finally execute\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"_2-6-promise中的类方法-静态方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-promise中的类方法-静态方法"}},[s._v("#")]),s._v(" 2.6 Promise中的类方法/静态方法")]),s._v(" "),e("h4",{attrs:{id:"_2-6-1-promise-reslove"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-1-promise-reslove"}},[s._v("#")]),s._v(" 2.6.1 Promise.reslove")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Promise.resolve('ice')\n//等价于\nnew Promise((resolve, reject) => resolve('ice'))\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[s._v("有的时候，你已经预知了状态的结果为fulfilled，则可以用这种简写方式")])]),s._v(" "),e("h4",{attrs:{id:"_2-6-2-promise-reject"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-2-promise-reject"}},[s._v("#")]),s._v(" 2.6.2 Promise.reject")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Promise.reject('ice error')\n//等价于\nnew Promise((resolve, reject) => reject('ice error'))\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[s._v("有的时候，你已经预知了状态的结果为rejected，则可以用这种简写方式")])]),s._v(" "),e("h4",{attrs:{id:"_2-6-3-promise-all"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-3-promise-all"}},[s._v("#")]),s._v(" 2.6.3 Promise.all")]),s._v(" "),e("p",[e("strong",[s._v("fulfilled 状态")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise1 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('hi ice')\n  }, 1000);\n})\n\nconst promise2 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('hi panda')\n  }, 2000);\n})\n\nconst promise3 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('hi grizzly')\n  }, 3000);\n})\n\nPromise.all([promise1, promise2, promise3]).then(res => console.log(res))\n\n//[ 'hi ice', 'hi panda', 'hi grizzly' ]\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("ul",[e("li",[s._v("all方法的参数传入为一个可迭代对象，返回一个promise，只有三个都为"),e("code",[s._v("resolve")]),s._v("状态的时候才会调用"),e("code",[s._v(".then")]),s._v("方法。")]),s._v(" "),e("li",[s._v("只要有一个promise的状态为rejected，则会回调"),e("code",[s._v(".catch")]),s._v("方法")])]),s._v(" "),e("p",[e("strong",[s._v("rejected状态")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise1 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('hi ice')\n  }, 1000);\n})\n\nconst promise2 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    reject('hi panda')\n  }, 2000);\n})\n\nconst promise3 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('hi grizzly')\n  }, 3000);\n})\n\nPromise.all([promise1, promise2, promise3]).then(res => console.log(res)).catch(err => console.log(err))\n\n//hi panda\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("ul",[e("li",[s._v("当遇到rejectd的时候，后续的promise结果我们是获取不到，并且会把reject的实参，传递给catch的err形参中")])]),s._v(" "),e("h4",{attrs:{id:"_2-6-4-promise-allsettled"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-4-promise-allsettled"}},[s._v("#")]),s._v(" 2.6.4 Promise.allSettled")]),s._v(" "),e("ul",[e("li",[s._v("上面的"),e("code",[s._v("Promise.all")]),s._v("有一个缺陷，就是当遇到一个rejected的状态，那么对于后面是"),e("code",[s._v("resolve")]),s._v("或者"),e("code",[s._v("reject")]),s._v("的结果我们是拿不到的")]),s._v(" "),e("li",[s._v("ES11 新增语法"),e("code",[s._v("Promise.allSettled")]),s._v("，无论状态是fulfilled/rejected都会把参数返回给我们")])]),s._v(" "),e("hr"),s._v(" "),e("p",[e("strong",[s._v("所有promise都有结果")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise1 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    reject('hi ice')\n  }, 1000);\n})\n\nconst promise2 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('hi panda')\n  }, 2000);\n})\n\nconst promise3 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    reject('hi grizzly')\n  }, 3000);\n})\n\nPromise.allSettled([promise1, promise2, promise3]).then(res => console.log(res))\n\n/* [\n  { status: 'rejected', reason: 'hi ice' },\n  { status: 'fulfilled', value: 'hi panda' },\n  { status: 'rejected', reason: 'hi grizzly' }\n] */\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br")])]),e("ul",[e("li",[s._v("该方法会在所有的Promise都有结果，无论是fulfilled，还是rejected，才会有最终的结果")])]),s._v(" "),e("p",[e("strong",[s._v("其中一个promise没有结果")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise1 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    reject('hi ice')\n  }, 1000);\n})\n\nconst promise2 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('hi panda')\n  }, 2000);\n})\n\nconst promise3 = new Promise((resolve, reject) => {})\n\nPromise.allSettled([promise1, promise2, promise3]).then(res => console.log(res))\n// 什么都不打印\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("ul",[e("li",[s._v("其中一个promise没有结果，则什么都结果都拿不到")])]),s._v(" "),e("h4",{attrs:{id:"_2-6-5-promise-race"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-5-promise-race"}},[s._v("#")]),s._v(" 2.6.5 Promise.race")]),s._v(" "),e("ul",[e("li",[s._v("race(竞争竞赛)")]),s._v(" "),e("li",[s._v("优先获取第一个返回的结果，无论结果是fulfilled还是rejectd")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise1 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    reject('hi error')\n  }, 1000);\n})\n\nconst promise2 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('hi panda')\n  }, 2000);\n})\n\nPromise.race([promise1, promise2])\n       .then(res => console.log(res))\n       .catch(e => console.log(e))\n       \n//hi error\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("h4",{attrs:{id:"_2-6-6-promise-any"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-6-promise-any"}},[s._v("#")]),s._v(" 2.6.6 Promise.any")]),s._v(" "),e("ul",[e("li",[s._v("与race类似，只获取第一个状态为fulfilled，如果全部为rejected则报错"),e("code",[s._v("AggregateError")])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const promise1 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    reject('hi error')\n  }, 1000);\n})\n\nconst promise2 = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('hi panda')\n  }, 2000);\n})\n\nPromise.any([promise1, promise2])\n       .then(res => console.log(res))\n       .catch(e => console.log(e))\n       \n//hi panda\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("h2",{attrs:{id:"_3-promise的回调地狱-进阶"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-promise的回调地狱-进阶"}},[s._v("#")]),s._v(" 3. Promise的回调地狱 (进阶)")]),s._v(" "),e("ul",[e("li",[s._v("我还是以一个需求作为切入点，把知识点嚼碎了，一点一点喂进你们嘴里。\n"),e("ul",[e("li",[s._v("当我发送网络请求的时候，需要拿到这次网络请求的数据，再发送网络请求，就这样重复三次，才能拿到我最终的结果。")])])])]),s._v(" "),e("h3",{attrs:{id:"_3-1-卧龙解法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-卧龙解法"}},[s._v("#")]),s._v(" 3.1 卧龙解法")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function requestData(url) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (url.includes('iceweb')) {\n        resolve(url)\n      } else {\n        reject('请求错误')\n      }\n    }, 1000);\n  })\n}\n\nrequestData('iceweb.io').then(res => {\n  requestData(`iceweb.org ${res}`).then(res => {\n    requestData(`iceweb.com ${res}`).then(res => {\n      console.log(res)\n    })\n  })\n})\n\n//iceweb.com iceweb.org iceweb.io\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("ul",[e("li",[s._v("虽然能够实现，但是多层代码的嵌套，可读性非常差，我们把这种多层次代码嵌套称之为回调地狱")])]),s._v(" "),e("h3",{attrs:{id:"_3-2-凤雏解法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-凤雏解法"}},[s._v("#")]),s._v(" 3.2 凤雏解法")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function requestData(url) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (url.includes('iceweb')) {\n        resolve(url)\n      } else {\n        reject('请求错误')\n      }\n    }, 1000);\n  })\n}\n\nrequestData('iceweb.io').then(res => {\n  return requestData(`iceweb.org ${res}`)\n}).then(res => {\n  return requestData(`iceweb.com ${res}`)\n}).then(res => {\n  console.log(res)\n})\n\n//iceweb.com iceweb.org iceweb.io\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("ul",[e("li",[s._v("利用了then链式调用这一特性，返回了一个新的promise，但是不够优雅，思考一下能不能写成同步的方式呢？")])]),s._v(" "),e("h3",{attrs:{id:"_3-3-生成器-promise解法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-生成器-promise解法"}},[s._v("#")]),s._v(" 3.3 生成器+Promise解法")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function requestData(url) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (url.includes('iceweb')) {\n        resolve(url)\n      } else {\n        reject('请求错误')\n      }\n    }, 1000);\n  })\n}\n\nfunction* getData(url) {\n  const res1 = yield requestData(url)\n  const res2 = yield requestData(res1)\n  const res3 = yield requestData(res2)\n\n  console.log(res3)\n}\n\nconst generator = getData('iceweb.io')\n\ngenerator.next().value.then(res1 => {\n  generator.next(`iceweb.org ${res1}`).value.then(res2 => {\n    generator.next(`iceweb.com ${res2}`).value.then(res3 => {\n      generator.next(res3)\n    })\n  })\n})\n\n//iceweb.com iceweb.org iceweb.io\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br")])]),e("ul",[e("li",[s._v("大家可以发现我们的"),e("code",[s._v("getData")]),s._v("已经变为同步的形式，可以拿到我最终的结果了。那么很多同学会问，generator一直调用"),e("code",[s._v(".next")]),s._v("不是也产生了回调地狱吗？")]),s._v(" "),e("li",[s._v("其实不用关心这个，我们可以发现它这个是有规律的，我们可以封装成一个自动化执行的函数，我们就不用关心内部是如何调用的了。")])]),s._v(" "),e("h3",{attrs:{id:"_3-4-自动化执行函数封装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-自动化执行函数封装"}},[s._v("#")]),s._v(" 3.4 自动化执行函数封装")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function requestData(url) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (url.includes('iceweb')) {\n        resolve(url)\n      } else {\n        reject('请求错误')\n      }\n    }, 1000);\n  })\n}\n\nfunction* getData() {\n  const res1 = yield requestData('iceweb.io')\n  const res2 = yield requestData(`iceweb.org ${res1}`)\n  const res3 = yield requestData(`iceweb.com ${res2}`)\n\n  console.log(res3)\n}\n\n//自动化执行 async await相当于自动帮我们执行.next\nfunction asyncAutomation(genFn) {\n  const generator = genFn()\n\n  const _automation = (result) => {\n    let nextData = generator.next(result)\n    if(nextData.done) return\n\n    nextData.value.then(res => {\n      _automation(res)\n    })\n  }\n\n  _automation()\n}\n\nasyncAutomation(getData)\n\n//iceweb.com iceweb.org iceweb.io\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br")])]),e("ul",[e("li",[s._v("利用promise+生成器的方式变相实现解决回调地狱问题，其实就是"),e("code",[s._v("async await")]),s._v("的一个变种而已")]),s._v(" "),e("li",[s._v("最早为"),e("strong",[s._v("TJ")]),s._v("实现，"),e("strong",[s._v("前端大神人物")])]),s._v(" "),e("li",[s._v("async await核心代码就类似这些，内部主动帮我们调用"),e("code",[s._v(".next")]),s._v("方法")])]),s._v(" "),e("h3",{attrs:{id:"_3-5-最终解决回调地狱的办法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-最终解决回调地狱的办法"}},[s._v("#")]),s._v(" 3.5 最终解决回调地狱的办法")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function requestData(url) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (url.includes('iceweb')) {\n        resolve(url)\n      } else {\n        reject('请求错误')\n      }\n    }, 1000);\n  })\n}\n\nasync function getData() {\n  const res1 = await requestData('iceweb.io')\n  const res2 = await requestData(`iceweb.org ${res1}`)\n  const res3 = await requestData(`iceweb.com ${res2}`)\n\n  console.log(res3)\n}\n\ngetData()\n\n//iceweb.com iceweb.org iceweb.io\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])]),e("ul",[e("li",[s._v("你会惊奇的发现，只要把"),e("code",[s._v("getData")]),s._v("生成器函数函数，改为"),e("code",[s._v("async")]),s._v("函数，"),e("code",[s._v("yeild")]),s._v("的关键字替换为"),e("code",[s._v("await")]),s._v("就可以实现异步代码同步写法了。")])]),s._v(" "),e("h2",{attrs:{id:"_4-async-await-剖析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-async-await-剖析"}},[s._v("#")]),s._v(" 4. async/await 剖析")]),s._v(" "),e("ul",[e("li",[s._v("async（异步的）")]),s._v(" "),e("li",[s._v("async 用于申明一个异步函数")])]),s._v(" "),e("h3",{attrs:{id:"_4-1-async内部代码同步执行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-async内部代码同步执行"}},[s._v("#")]),s._v(" 4.1 async内部代码同步执行")]),s._v(" "),e("ul",[e("li",[s._v("异步函数的内部代码执行过程和普通的函数是一致的，默认情况下也是会被同步执行")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("async function sayHi() {\n  console.log('hi ice')\n}\n\nsayHi()\n\n//hi ice\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"_4-2-异步函数的返回值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-异步函数的返回值"}},[s._v("#")]),s._v(" 4.2 异步函数的返回值")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("异步函数的返回值和普通返回值有所区别")]),s._v(" "),e("ul",[e("li",[s._v("普通函数主动返回什么就返回什么，不返回为"),e("code",[s._v("undefined")])]),s._v(" "),e("li",[s._v("异步函数的返回值特点\n"),e("ul",[e("li",[s._v("明确有返回一个普通值，相当于"),e("code",[s._v("Promise.resolve")]),s._v("(返回值)")]),s._v(" "),e("li",[s._v("返回一个thenable对象则由，then方法中的"),e("code",[s._v("resolve")]),s._v(",或者"),e("code",[s._v("reject")]),s._v("有关")]),s._v(" "),e("li",[s._v("明确返回一个promise，则由这个promise决定")])])])])]),s._v(" "),e("li",[e("p",[s._v("异步函数中可以使用"),e("code",[s._v("await")]),s._v("关键字，现在在全局也可以进行"),e("code",[s._v("await")]),s._v("，但是不推荐。会阻塞主进程的代码执行")])])]),s._v(" "),e("h3",{attrs:{id:"_4-3-异步函数的异常处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-异步函数的异常处理"}},[s._v("#")]),s._v(" 4.3 异步函数的异常处理")]),s._v(" "),e("ul",[e("li",[s._v("如果函数内部中途发生错误，可以通过try catch的方式捕获异常")]),s._v(" "),e("li",[s._v("如果函数内部中途发生错误，也可以通过函数的返回值.catch进行捕获")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\nasync function sayHi() {\n  console.log(res)\n}\nsayHi().catch(e => console.log(e))\n\n//或者\n\nasync function sayHi() {\n  try {\n    console.log(res)\n  }catch(e) {\n    console.log(e)\n  }\n}\n\nsayHi()\n\n//ReferenceError: res is not defined\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("h3",{attrs:{id:"_4-4-await-关键字"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-await-关键字"}},[s._v("#")]),s._v(" 4.4 await 关键字")]),s._v(" "),e("ul",[e("li",[s._v("异步函数中可以使用"),e("code",[s._v("await")]),s._v("关键字，普通函数不行")]),s._v(" "),e("li",[s._v("await特点\n"),e("ul",[e("li",[s._v("通常await关键字后面都是跟一个Promise\n"),e("ul",[e("li",[s._v("可以是普通值")]),s._v(" "),e("li",[s._v("可以是thenable")]),s._v(" "),e("li",[s._v("可以是Promise主动调用"),e("code",[s._v("resolve或者reject")])])])]),s._v(" "),e("li",[s._v("这个promise状态变为fulfilled才会执行"),e("code",[s._v("await")]),s._v("后续的代码，所以"),e("code",[s._v("await")]),s._v("后面的代码，相当于包括在"),e("code",[s._v(".then")]),s._v("方法的回调中，如果状态变为rejected，你则需要在函数内部"),e("code",[s._v("try catch")]),s._v("，或者进行链式调用进行"),e("code",[s._v(".catch")]),s._v("操作")])])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function requestData(url) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (url.includes('iceweb')) {\n        resolve(url)\n      } else {\n        reject('请求错误')\n      }\n    }, 1000);\n  })\n}\n\nasync function getData() {\n  const res = await requestData('iceweb.io')\n  console.log(res)\n}\n\ngetData()\n\n// iceweb.io\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("h2",{attrs:{id:"_5-结语"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-结语"}},[s._v("#")]),s._v(" 5. 结语")]),s._v(" "),e("ul",[e("li",[s._v("如果现在真的看不到未来是怎样，你就不如一直往前走，不知道什么时候天亮，去奔跑就好，跑着跑着天就亮了。")])]),s._v(" "),e("p",[s._v("本文转自 "),e("a",{attrs:{href:"https://juejin.cn/post/7144308012952322084",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://juejin.cn/post/7144308012952322084"),e("OutboundLink")],1),s._v("，如有侵权，请联系删除。")])])}),[],!1,null,null,null);e.default=r.exports}}]);